# ëˆ ì£¼ê³  íŒ”ì§€ë§ˆì…ˆ
# í‹°ì¼“ë¡œê·¸ ê°™ì€ê±° ì—†ìŒ ë„£ê³ ì‹¶ìœ¼ë©´ ì¥í”¼í‹°ëŒë¦¬ë˜ê°€ ì²˜ ë„£ë˜ê°€í•˜ì…ˆ

import disnake
from disnake.ext import commands

intents = disnake.Intents.default()
intents.messages = True
intents.guilds = True
intents.members = True
intents.message_content = True

bot = commands.InteractionBot(intents=intents)
user_threads = {}
thread_to_user = {}

# ìœ„ì— ìˆëŠ”ê²Œ ì„œë²„ì•„ì´ë”” ë°‘ì—ìˆëŠ”ê²Œ í¬ëŸ¼ ì•„ì´ë”” ã…‡ã…‹?
server_id = 1
forum_id = 1

@bot.event
async def on_ready():
    print(f"ì„œë¹„ìŠ¤ ì‹œì‘")

@bot.event
async def on_message(message: disnake.Message):
    if message.author.bot:
        return

    if message.guild is None:
        user = message.author
        if user.id not in user_threads:
            guild = bot.get_guild(server_id)
            if guild is None:
                return
            forum_channel = guild.get_channel(forum_id)
            if forum_channel is None:
                return

            embed = disnake.Embed(title=user.display_name, description=message.content, color=0x2ecc71)
            embed.set_thumbnail(url=user.display_avatar.url)

            thread_with_message = await forum_channel.create_thread(
                name=user.display_name,
                embeds=[embed]
            )
            thread = thread_with_message.thread  # ì‹¤ì œ Thread ê°ì²´

            user_threads[user.id] = thread
            thread_to_user[thread.id] = user.id

        else:
            thread = user_threads[user.id]
            embed = disnake.Embed(description=message.content, color=0x3498db)
            embed.set_thumbnail(url=message.author.display_avatar.url)
            await thread.send(embed=embed)

        for emoji in ["ğŸ‡º", "ğŸ‡¹", "ğŸ‡´", "ğŸ‡µ", "ğŸ‡®", "ğŸ…°"]:  # ì´ê±° ë‹˜ ì¢†ëŒ€ë¡œ ë°”ê¾¸ë©´ ë¨ ë¦¬ìŠ¤íŠ¸ë¼ì„œ ê·¸ëƒ¥ ì½¤ë§ˆ í•˜ê³  ë” ëŠ˜ë¦´ ìˆ˜ ìˆìŒ
            await message.add_reaction(emoji)
    else:
        if message.channel.type == disnake.ChannelType.public_thread:
            thread = message.channel
            if thread.id in thread_to_user:
                user_id = thread_to_user[thread.id]
                user = await bot.fetch_user(user_id)
                if user:
                    embed = disnake.Embed(description=message.content, color=0xe67e22)
                    await user.send(embed=embed)
                    for emoji in ["âœ…"]:  # ì´ê±° ë‹˜ ì¢†ëŒ€ë¡œ ë°”ê¾¸ë©´ ë¨ ë¦¬ìŠ¤íŠ¸ë¼ì„œ ê·¸ëƒ¥ ì½¤ë§ˆ í•˜ê³  ë” ëŠ˜ë¦´ ìˆ˜ ìˆìŒ
                        await message.add_reaction(emoji)

@bot.slash_command(description="ë¬¸ì˜ë‹«ê¸°")
@commands.has_guild_permissions(administrator=True)
async def ë‹«ê¸°(inter: disnake.ApplicationCommandInteraction):
    if not isinstance(inter.channel, disnake.Thread):
        await inter.response.send_message("í‹°ì¼“ëŒ€í™” í¬ìŠ¤íŠ¸ì—ì„œ í•´ì£¼ì„¸ìš©", ephemeral=True)
        return

    thread = inter.channel
    if thread.id in thread_to_user:
        user_id = thread_to_user[thread.id]
        if user_id in user_threads:
            del user_threads[user_id]
        del thread_to_user[thread.id]

    try:
        await thread.delete()
        await inter.response.send_message("ì‚­ì œì™„ë£Œ", ephemeral=True)
    except disnake.errors.NotFound:
        await inter.response.send_message("ë­í•¨?", ephemeral=True)
    except disnake.errors.Forbidden:
        await inter.response.send_message("ë‹ˆ ëª»í•¨ ì´ê±° ã…‡ã…‡", ephemeral=True)

bot.run("")
